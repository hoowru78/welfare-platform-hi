<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ì¡°ì‚¬ - ë‚¨í•´êµ° ë…¸ì¸ ë³µì§€ ì¶”ì²œ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ -->
    <style>
        :root {
            --primary-500: #265DAB;
            --primary-600: #1e40af;
            --primary-100: #dbeafe;
            --secondary-100: #E9F0FA;
            --accent-400: #FFE66D;
            --neutral-50: #F9F9F9;
            --neutral-600: #4A4A4A;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--neutral-50);
        }
        
        .text-size-normal {
            font-size: 1.125rem;
            line-height: 1.7;
        }
        
        .text-size-medium {
            font-size: 1.375rem;
            line-height: 1.6;
        }
        
        .text-size-large {
            font-size: 1.5rem;
            line-height: 1.5;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1.125rem;
            line-height: 1.5;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--primary-500);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-600);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-100);
            color: var(--primary-600);
            border: 1px solid #cbd5e1;
        }
        
        .btn-secondary:hover {
            background-color: #e2e8f0;
        }
        
        .btn-accessibility {
            min-height: 40px;
            min-width: 40px;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: white;
            border: 1px solid #cbd5e1;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-accessibility:hover {
            background-color: var(--primary-100);
            border-color: var(--primary-500);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-500);
            transition: width 0.3s ease;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #d1d5db;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .step-number.active {
            background-color: var(--primary-500);
            color: white;
        }
        
        .step-number.completed {
            background-color: #10b981;
            color: white;
        }
        
        .step-title {
            font-size: 0.875rem;
            color: #6b7280;
            text-align: center;
        }
        
        .question-group {
            margin-bottom: 2rem;
        }
        
        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--neutral-600);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
        }
        
        .option-item:hover {
            border-color: var(--primary-500);
            background-color: var(--primary-100);
        }
        
        .option-item.selected {
            border-color: var(--primary-500);
            background-color: var(--primary-100);
        }
        
        .option-input {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            accent-color: var(--primary-500);
        }
        
        .option-text {
            flex: 1;
            font-size: 1.125rem;
        }
        
        .voice-btn {
            background-color: var(--primary-500);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .voice-btn:hover {
            background-color: var(--primary-600);
            transform: scale(1.1);
        }
        
        .floating-voice {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-500);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.2s;
        }
        
        .floating-voice:hover {
            background-color: var(--primary-600);
            transform: scale(1.1);
        }
        
        .high-contrast {
            background-color: #000000 !important;
            color: #ffffff !important;
        }
        
        .high-contrast .option-item {
            background-color: #1a1a1a !important;
            border-color: #ffffff !important;
            color: #ffffff !important;
        }
        
        .high-contrast .btn-primary {
            background-color: #ffff00 !important;
            color: #000000 !important;
        }
        
        @media (max-width: 768px) {
            .btn {
                min-height: 48px;
                padding: 0.875rem 1.5rem;
            }
            
            .option-item {
                padding: 0.875rem;
            }
            
            .step-number {
                width: 32px;
                height: 32px;
            }
        }
    </style>
</head>
<body class="min-h-screen text-size-normal" id="main-body">
    <!-- ì ‘ê·¼ì„± ìŠ¤í‚µ ë§í¬ -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-blue-600 text-white p-2 z-50">
        ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°
    </a>
    
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="h-12 w-12 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-xl">ë‚¨</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        ë‚¨í•´êµ° ë…¸ì¸ ë³µì§€ ì¶”ì²œ
                    </h1>
                </div>
                
                <!-- ì ‘ê·¼ì„± ë„êµ¬ -->
                <div class="flex items-center gap-2">
                    <button id="font-size-btn" class="btn-accessibility" title="ê¸€ì í¬ê¸° ì¡°ì ˆ" aria-label="ê¸€ì í¬ê¸° ì¡°ì ˆ">
                        <span class="font-bold">ê°€</span>
                    </button>
                    <button id="voice-toggle-btn" class="btn-accessibility" title="ìŒì„± ì•ˆë‚´ í† ê¸€" aria-label="ìŒì„± ì•ˆë‚´ í† ê¸€">
                        ğŸ”Š
                    </button>
                    <button id="high-contrast-btn" class="btn-accessibility" title="ê³ ëŒ€ë¹„ ëª¨ë“œ" aria-label="ê³ ëŒ€ë¹„ ëª¨ë“œ">
                        ğŸŒ“
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="step-indicator" id="step-indicator">
                <div class="step">
                    <div class="step-number active" id="step-1">1</div>
                    <div class="step-title">ê±´ê°• ìƒíƒœ</div>
                </div>
                <div class="step">
                    <div class="step-number" id="step-2">2</div>
                    <div class="step-title">ìƒí™œ í™˜ê²½</div>
                </div>
                <div class="step">
                    <div class="step-number" id="step-3">3</div>
                    <div class="step-title">ê²½ì œ ìƒí™©</div>
                </div>
                <div class="step">
                    <div class="step-number" id="step-4">4</div>
                    <div class="step-title">ì‚¬íšŒ ê´€ê³„</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 25%"></div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main id="main-content" class="max-w-7xl mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800" id="category-title">ê±´ê°• ìƒíƒœì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”</h2>
                    <p class="text-gray-600 mt-2" id="category-description">
                        ì–´ë¥´ì‹ ì˜ í˜„ì¬ ê±´ê°• ìƒíƒœë¥¼ íŒŒì•…í•˜ì—¬ ì ì ˆí•œ ë³µì§€ í˜œíƒì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤
                    </p>
                </div>
                
                <div class="p-6">
                    <form id="survey-form">
                        <div id="questions-container">
                            <!-- ì§ˆë¬¸ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- í•˜ë‹¨ ê³ ì • ë²„íŠ¼ -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg">
        <div class="max-w-7xl mx-auto max-w-3xl">
            <div class="flex justify-between gap-4">
                <button id="prev-btn" class="btn btn-secondary flex-1" disabled>
                    â† ì´ì „ ë‹¨ê³„
                </button>
                <button id="next-btn" class="btn btn-primary flex-1">
                    ë‹¤ìŒ ë‹¨ê³„ â†’
                </button>
            </div>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ìŒì„± ë²„íŠ¼ -->
    <div class="floating-voice" id="floating-voice-btn" title="ìŒì„± ì•ˆë‚´" aria-label="ìŒì„± ì•ˆë‚´ ë²„íŠ¼">
        ğŸ”Š
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="analysis-loading" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg p-8 text-center max-w-md mx-4">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-6"></div>
                <h3 class="text-xl font-bold mb-2">AIê°€ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</h3>
                <p class="text-gray-600 mb-4">ì–´ë¥´ì‹ ì˜ ì„¤ë¬¸ ë‹µë³€ì„ ë°”íƒ•ìœ¼ë¡œ ë§ì¶¤í˜• ë³µì§€ í˜œíƒì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.</p>
                <div class="text-sm text-gray-500">
                    ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentStep = 1;
        let totalSteps = 4;
        let currentQuestions = [];
        let surveyAnswers = {};
        let isVoiceEnabled = false;
        let isHighContrast = false;
        let fontSizeLevel = 1;
        let speechSynthesis = window.speechSynthesis;
        let currentUser = null;
        let currentSession = null;
        
        // API ê¸°ë³¸ URL
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // DOM ìš”ì†Œë“¤
        const questionsContainer = document.getElementById('questions-container');
        const categoryTitle = document.getElementById('category-title');
        const categoryDescription = document.getElementById('category-description');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressFill = document.getElementById('progress-fill');
        const fontSizeBtn = document.getElementById('font-size-btn');
        const voiceToggleBtn = document.getElementById('voice-toggle-btn');
        const highContrastBtn = document.getElementById('high-contrast-btn');
        const floatingVoiceBtn = document.getElementById('floating-voice-btn');
        const mainBody = document.getElementById('main-body');
        const analysisLoading = document.getElementById('analysis-loading');
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeFromStorage();
            loadUserPreferences();
            initializeEventListeners();
            loadCurrentStep();
        });
        
        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë³µì›
        function initializeFromStorage() {
            const savedUser = sessionStorage.getItem('currentUser');
            const savedSession = sessionStorage.getItem('currentSession');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }
            
            if (savedSession) {
                currentSession = JSON.parse(savedSession);
            }
            
            if (!currentUser || !currentSession) {
                alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                window.location.href = 'index.html';
                return;
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initializeEventListeners() {
            prevBtn.addEventListener('click', goToPreviousStep);
            nextBtn.addEventListener('click', goToNextStep);
            
            // ì ‘ê·¼ì„± ë²„íŠ¼ë“¤
            fontSizeBtn.addEventListener('click', toggleFontSize);
            voiceToggleBtn.addEventListener('click', toggleVoice);
            highContrastBtn.addEventListener('click', toggleHighContrast);
            floatingVoiceBtn.addEventListener('click', toggleVoice);
            
            // í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft' && !prevBtn.disabled) {
                    goToPreviousStep();
                } else if (e.key === 'ArrowRight') {
                    goToNextStep();
                }
            });
        }
        
        // í˜„ì¬ ë‹¨ê³„ ë¡œë“œ
        async function loadCurrentStep() {
            try {
                const response = await fetch(`${API_BASE_URL}/survey/questions?step=${currentStep}`);
                const data = await response.json();
                
                if (response.ok) {
                    currentQuestions = data.questions;
                    updateStepIndicator();
                    updateProgressBar();
                    renderQuestions(data);
                    
                    if (isVoiceEnabled) {
                        speak(`${data.category} ì„¤ë¬¸ì„ ì‹œì‘í•©ë‹ˆë‹¤.`);
                    }
                } else {
                    alert('ì„¤ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì§ˆë¬¸ ë Œë”ë§
        function renderQuestions(data) {
            categoryTitle.textContent = `${data.category}ì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”`;
            categoryDescription.textContent = `ì–´ë¥´ì‹ ì˜ í˜„ì¬ ${data.category.toLowerCase()}ì„ íŒŒì•…í•˜ì—¬ ì ì ˆí•œ ë³µì§€ í˜œíƒì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤`;
            
            questionsContainer.innerHTML = '';
            
            data.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-group';
                
                const questionHeader = document.createElement('div');
                questionHeader.className = 'question-text';
                questionHeader.innerHTML = `
                    <span>${question.text}</span>
                    <button type="button" class="voice-btn" onclick="speakQuestion('${question.text}')" aria-label="ì§ˆë¬¸ ìŒì„± ì¬ìƒ">
                        ğŸ”Š
                    </button>
                `;
                
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'option-group';
                
                question.options.forEach((option, optionIndex) => {
                    const optionLabel = document.createElement('label');
                    optionLabel.className = 'option-item';
                    
                    const inputType = question.type === 'multiple_choice' ? 'checkbox' : 'radio';
                    const inputName = question.type === 'multiple_choice' ? `${question.id}[]` : question.id;
                    
                    optionLabel.innerHTML = `
                        <input type="${inputType}" name="${inputName}" value="${option.value}" 
                               class="option-input" data-score="${option.score}"
                               onchange="handleOptionChange('${question.id}', '${option.value}', ${option.score}, '${question.type}')">
                        <span class="option-text">${option.text}</span>
                    `;
                    
                    optionsDiv.appendChild(optionLabel);
                });
                
                questionDiv.appendChild(questionHeader);
                questionDiv.appendChild(optionsDiv);
                questionsContainer.appendChild(questionDiv);
            });
        }
        
        // ì˜µì…˜ ë³€ê²½ ì²˜ë¦¬
        function handleOptionChange(questionId, optionValue, score, questionType) {
            if (!surveyAnswers[currentStep]) {
                surveyAnswers[currentStep] = {};
            }
            
            if (questionType === 'multiple_choice') {
                if (!surveyAnswers[currentStep][questionId]) {
                    surveyAnswers[currentStep][questionId] = [];
                }
                
                const checkbox = event.target;
                if (checkbox.checked) {
                    surveyAnswers[currentStep][questionId].push({
                        value: optionValue,
                        score: score
                    });
                } else {
                    surveyAnswers[currentStep][questionId] = surveyAnswers[currentStep][questionId].filter(
                        item => item.value !== optionValue
                    );
                }
            } else {
                surveyAnswers[currentStep][questionId] = [{
                    value: optionValue,
                    score: score
                }];
            }
            
            // ë¶€ëª¨ ë¼ë²¨ì— ì„ íƒ ìƒíƒœ í´ë˜ìŠ¤ ì¶”ê°€/ì œê±°
            const label = event.target.closest('.option-item');
            if (event.target.checked) {
                label.classList.add('selected');
            } else {
                label.classList.remove('selected');
            }
            
            // ìë™ ì €ì¥
            saveCurrentProgress();
        }
        
        // ì´ì „ ë‹¨ê³„ë¡œ ì´ë™
        function goToPreviousStep() {
            if (currentStep > 1) {
                currentStep--;
                loadCurrentStep();
                updateNavigationButtons();
            }
        }
        
        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
        async function goToNextStep() {
            // í˜„ì¬ ë‹¨ê³„ ë‹µë³€ ê²€ì¦
            if (!validateCurrentStep()) {
                alert('ëª¨ë“  ì§ˆë¬¸ì— ë‹µí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‹µë³€ ì €ì¥
            await saveStepAnswers();
            
            if (currentStep < totalSteps) {
                currentStep++;
                loadCurrentStep();
                updateNavigationButtons();
            } else {
                // ëª¨ë“  ì„¤ë¬¸ ì™„ë£Œ - ê²°ê³¼ ìƒì„±
                await generateResults();
            }
        }
        
        // í˜„ì¬ ë‹¨ê³„ ê²€ì¦
        function validateCurrentStep() {
            const currentStepAnswers = surveyAnswers[currentStep];
            
            if (!currentStepAnswers) {
                return false;
            }
            
            // ëª¨ë“  ì§ˆë¬¸ì— ë‹µí–ˆëŠ”ì§€ í™•ì¸
            for (const question of currentQuestions) {
                if (!currentStepAnswers[question.id] || currentStepAnswers[question.id].length === 0) {
                    return false;
                }
            }
            
            return true;
        }
        
        // ë‹¨ê³„ë³„ ë‹µë³€ ì €ì¥
        async function saveStepAnswers() {
            const answers = [];
            
            for (const [questionId, selectedOptions] of Object.entries(surveyAnswers[currentStep])) {
                const totalScore = selectedOptions.reduce((sum, option) => sum + option.score, 0);
                
                answers.push({
                    question_id: questionId,
                    selected_options: selectedOptions.map(option => option.value),
                    score: totalScore
                });
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/survey/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: currentSession.session_id,
                        answers: answers
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    console.error('ë‹µë³€ ì €ì¥ ì‹¤íŒ¨:', data.error);
                }
            } catch (error) {
                console.error('ë‹µë³€ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
        
        // ê²°ê³¼ ìƒì„±
        async function generateResults() {
            analysisLoading.classList.remove('hidden');
            
            if (isVoiceEnabled) {
                speak('ì„¤ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. AIê°€ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.');
            }
            
            try {
                // ì ì‹œ ëŒ€ê¸° (ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜)
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = `results.html?userKey=${currentUser.user_key}`;
            } catch (error) {
                console.error('ê²°ê³¼ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
                alert('ê²°ê³¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                analysisLoading.classList.add('hidden');
            }
        }
        
        // ë‹¨ê³„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
        function updateStepIndicator() {
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                
                if (i < currentStep) {
                    stepElement.className = 'step-number completed';
                } else if (i === currentStep) {
                    stepElement.className = 'step-number active';
                } else {
                    stepElement.className = 'step-number';
                }
            }
        }
        
        // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
        function updateProgressBar() {
            const percentage = (currentStep / totalSteps) * 100;
            progressFill.style.width = `${percentage}%`;
        }
        
        // ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateNavigationButtons() {
            prevBtn.disabled = currentStep === 1;
            nextBtn.textContent = currentStep === totalSteps ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ ë‹¨ê³„ â†’';
        }
        
        // í˜„ì¬ ì§„í–‰ ìƒí™© ì €ì¥
        function saveCurrentProgress() {
            sessionStorage.setItem('surveyAnswers', JSON.stringify(surveyAnswers));
            sessionStorage.setItem('currentStep', currentStep);
        }
        
        // ì§ˆë¬¸ ìŒì„± ì¬ìƒ
        function speakQuestion(text) {
            if (isVoiceEnabled) {
                speak(text);
            } else {
                speak(text); // ì§ˆë¬¸ ë²„íŠ¼ì€ ìŒì„± ì„¤ì •ê³¼ ê´€ê³„ì—†ì´ í•­ìƒ ì‘ë™
            }
        }
        
        // ì ‘ê·¼ì„± ê¸°ëŠ¥ë“¤ (main.jsì™€ ë™ì¼í•œ êµ¬í˜„)
        function toggleFontSize() {
            fontSizeLevel = (fontSizeLevel % 3) + 1;
            
            const body = document.body;
            body.classList.remove('text-size-normal', 'text-size-medium', 'text-size-large');
            
            switch (fontSizeLevel) {
                case 1:
                    body.classList.add('text-size-normal');
                    break;
                case 2:
                    body.classList.add('text-size-medium');
                    break;
                case 3:
                    body.classList.add('text-size-large');
                    break;
            }
            
            localStorage.setItem('fontSizeLevel', fontSizeLevel);
            
            if (isVoiceEnabled) {
                speak(`ê¸€ì í¬ê¸°ë¥¼ ${fontSizeLevel}ë‹¨ê³„ë¡œ ì¡°ì ˆí–ˆìŠµë‹ˆë‹¤.`);
            }
        }
        
        function toggleVoice() {
            isVoiceEnabled = !isVoiceEnabled;
            
            if (isVoiceEnabled) {
                voiceToggleBtn.classList.add('bg-blue-100', 'border-blue-500');
                floatingVoiceBtn.classList.add('bg-blue-700');
                speak('ìŒì„± ì•ˆë‚´ê°€ ì¼œì¡ŒìŠµë‹ˆë‹¤.');
            } else {
                voiceToggleBtn.classList.remove('bg-blue-100', 'border-blue-500');
                floatingVoiceBtn.classList.remove('bg-blue-700');
                
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
            }
            
            localStorage.setItem('isVoiceEnabled', isVoiceEnabled);
        }
        
        function toggleHighContrast() {
            isHighContrast = !isHighContrast;
            
            if (isHighContrast) {
                mainBody.classList.add('high-contrast');
                highContrastBtn.classList.add('bg-yellow-400', 'border-yellow-600');
            } else {
                mainBody.classList.remove('high-contrast');
                highContrastBtn.classList.remove('bg-yellow-400', 'border-yellow-600');
            }
            
            localStorage.setItem('isHighContrast', isHighContrast);
            
            if (isVoiceEnabled) {
                speak(`ê³ ëŒ€ë¹„ ëª¨ë“œê°€ ${isHighContrast ? 'ì¼œì¡ŒìŠµë‹ˆë‹¤' : 'êº¼ì¡ŒìŠµë‹ˆë‹¤'}.`);
            }
        }
        
        function speak(text) {
            if (!speechSynthesis) return;
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.8;
            utterance.pitch = 1;
            
            speechSynthesis.speak(utterance);
        }
        
        function loadUserPreferences() {
            const savedFontSize = localStorage.getItem('fontSizeLevel');
            if (savedFontSize) {
                fontSizeLevel = parseInt(savedFontSize);
                const body = document.body;
                body.classList.remove('text-size-normal', 'text-size-medium', 'text-size-large');
                
                switch (fontSizeLevel) {
                    case 1:
                        body.classList.add('text-size-normal');
                        break;
                    case 2:
                        body.classList.add('text-size-medium');
                        break;
                    case 3:
                        body.classList.add('text-size-large');
                        break;
                }
            }
            
            const savedVoice = localStorage.getItem('isVoiceEnabled');
            if (savedVoice === 'true') {
                isVoiceEnabled = true;
                voiceToggleBtn.classList.add('bg-blue-100', 'border-blue-500');
                floatingVoiceBtn.classList.add('bg-blue-700');
            }
            
            const savedHighContrast = localStorage.getItem('isHighContrast');
            if (savedHighContrast === 'true') {
                isHighContrast = true;
                mainBody.classList.add('high-contrast');
                highContrastBtn.classList.add('bg-yellow-400', 'border-yellow-600');
            }
        }
        
        // í˜ì´ì§€ ì´íƒˆ ë°©ì§€
        window.addEventListener('beforeunload', function(e) {
            if (Object.keys(surveyAnswers).length > 0) {
                const message = 'ì„¤ë¬¸ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';
                e.preventDefault();
                e.returnValue = message;
                return message;
            }
        });
        
        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updateNavigationButtons();
    </script>
</body>
</html> 